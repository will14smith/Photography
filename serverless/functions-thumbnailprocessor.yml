thumbnail-ecs-trigger:
  handler: Toxon.Photography::Toxon.Photography.ECSTriggerFunction::Handle
  environment:
    TASK_DEFINITION: ${self:custom.thumbnailProcessorTaskArn}
    CLUSTER_NAME: ${self:custom.thumbnailProcessorClusterArn}
    CONTAINER_NAME: ${self:service}-${self:provider.stage}-thumbnailprocessor # TODO variable
    TASK_SUBNETS: ${self:custom.thumbnailSubnets}
    TASK_SECURITY_GROUPS: ${self:custom.thumbnailSecurityGroups}
  events:
    - sns:
        arn: ${self:custom.imageProcessorTopicArn}
        topicName: ${self:custom.imageProcessorTopicName}

thumbnail-ecs-handler:
  handler: Toxon.Photography::Toxon.Photography.ECSHandlerFunction::Handle
  events:
    - cloudwatchEvent:
        event:
          source:
            - aws.ecs
          detail-type:
            - ECS Task State Change
          detail:
            clusterArn:
              - ${self:custom.thumbnailProcessorClusterArn}
